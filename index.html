<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset="utf-8">
        <title>Customers</title>
		<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js'></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
		<script type="text/javascript">
			var myApp = angular.module("myApp", ['ngRoute']);
		    myApp.config(function ($routeProvider) {
		      $routeProvider
		        .when('/',{
		            templateUrl: 'partials/customer.html'
		        })
		        .when('/partial2',{
		            templateUrl: 'partials/order.html'
		        })
		        .otherwise({
		          redirectTo: '/'
		        });
		    });
			myApp.factory("customerFactory", function()
				{
				var customers = [
					{name: "John", created_at: "2013-08-02"},
					{name: "Frank", created_at: "2012-11-2"},
					{name: "Erika", created_at: "2015-02-13"},
					{name: "Steven", created_at: "2014-07-31"}
				];
				var orders = [
					{name: "Frank", product: "Shoes", quantity: 2},
					{name: "Erika", product: "Bike", quantity: 1},
					{name: "Steven", product: "Bath towel", quantity: 3}
				]
				var factory = {};
				factory.customers = customers;
				factory.orders = orders;
				factory.addCustomer = function(newCustomer)
					{
						var unique = true;
						for(var person in customers)
						{
							if(customers[person].name == newCustomer.name)
							{
								unique = false;
							}
						}
						if(unique)
						{
							var today = new Date().toISOString().slice(0, 10);
							newCustomer.created_at = today;
							customers.push(newCustomer);
						}
						else
						{
							alert("Name exist!");
						}
					}
				factory.removeCustomer = function(person)
					{
						customers.splice(customers.indexOf(person), 1);
					}
				factory.removeOrder = function(order)
					{
						orders.splice(customers.indexOf(order), 1);
					}
				factory.addOrder = function(newOrder)
					{
						console.log(newOrder);
						orders.push(newOrder);
					}
				return factory;
				});
			myApp.controller("customersController", function($scope, customerFactory)
			{
				$scope.customers = customerFactory.customers;
				$scope.orders = customerFactory.orders;
				$scope.addCustomer = function()
					{
						console.log($scope.newCustomer);
						customerFactory.addCustomer($scope.newCustomer);
						$scope.newCustomer={};
					}
				$scope.removeCustomer = function(person)
					{
						customerFactory.removeCustomer(person);
					}				
				$scope.removeOrder = function(order)
					{
						customerFactory.removeOrder(order);
					}
				$scope.addOrder = function()
					{
						customerFactory.addOrder($scope.newOrder);
					}
			})
		</script>
		<style type="text/css">
			.controller
			{
				margin: 100px 0 0 200px;
			};
			.search
			{
				margin-top: 20px;
			}
		</style>
    </head>
    <body ng-app="myApp">
        <div class="controller" ng-controller="customersController">
            <a href="#/">Customer</a> | <a href="#/partial2">Order</a>
        	<div ng-view></div>
        	
        	<div class="search">
        		Search Customer: <input type="text" ng-model="filter_name" placeholder="search name...">
        	</div>

        </div>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    </body>
</html>

